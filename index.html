<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/reset.css">
    <link rel=stylesheet href="css/style.css" media="all">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Freestyle Radio</title>
</head>

<body>
    <!-- Страница пароля -->
    <div id="password-protect">
        <h1>FreeStyle Radio</h1>
        <!-- <p>My life is not ruled by a dollar, my life is ruled by a melody</p> -->
        <input id="pass-input" type="password" placeholder="Enter password">
        <button id="pass-btn">Send</button>
        <div id="wrong-pass" style="color:#ff8080;">Wrong password</div>
        <div id="attempts-left" style="color:#ffd480;"></div>
        <div id="locked">Too many attempts. Refresh the page.</div>
    </div>
    <!-- end -->
    <!-- Содержимое сайта -->
    <div class="container">
        <div class="container__box">  
            <header>
                <div class="logo">
                    <img src="img/Freestyle-Logo-removebg-preview.png" alt="logo" class="logo__img">
                </div>
                <!-- Гамбургер -->
                <button id="hamburger" class="hamburger" aria-label="Открыть меню">
                    <span></span><span></span><span></span>
                </button>
            </header>
            <div class="radio-battons">
                <div class="btn" data-audio="stream1" id="btn1"><span>DANCE</span></div>
                <div class="btn" data-audio="stream2" id="btn2"><span>HIP-HOP</span></div>
                <div class="btn" data-audio="stream3" id="btn3"><span>K-POP</span></div>
                <div class="btn" data-audio="stream4" id="btn4"><span>ELECTRO HOUSE</span></div>
            </div>

            <audio id="stream1" src="https://myradio24.org/37113" crossorigin="anonymous"></audio>
            <audio id="stream2" src="#"></audio>
            <audio id="stream3" src="#"></audio>
            <audio id="stream4" src="#"></audio>

            <!-- Регулятор громкости -->
            <div class="volume-control">
                <input type="range" id="volume" min="0" max="1" step="0.01" value="0.1">
            </div>
        </div>  
        <div class="container__box">
            <!-- Футер -->
            <footer class="footer">
                <button id="donateBtn" class="donate-btn">DONATE</button>

                <!-- Выпадающий список -->
                <div id="donateDropdown" class="donate-dropdown">
                    <p>Support the project<br>4874 1000 2089 7784</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Модальное окно с эквалайзером -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="equalizer-container">
                <div class="equalizer-row">
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>32Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>64Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>125Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>250Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>500Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>630Hz</label>
                    </div>
                </div>
                <div class="equalizer-row">
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>800Hz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>1kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>1.25kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>1.6kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>2kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>2.5kHz</label>
                    </div>
                </div>
                <div class="equalizer-row">
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>3.15kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>4kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>5kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>6.3kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>8kHz</label>
                    </div>
                    <div class="band"><input type="range" min="-12" max="12" value="0" step="1"><label>16kHz</label>
                    </div>
                </div>
                <div class="equalizer-buttons">
                    <button id="save-eq-settings">Save</button>
                    <button id="reset-eq-settings">Reset</button>
                </div>
                <p id="eq-message"></p>
            </div>
        </div>
    </div>

    <script>


      //-----------------------------------------------------\\
     // ==================== Радио кнопки =================== \\
    //---------------------------------------------------------\\     

    const buttons = document.querySelectorAll('.btn');
    const audios = [
        document.getElementById('stream1'),
        document.getElementById('stream2'),
        document.getElementById('stream3'),
        document.getElementById('stream4')
    ];

    // переключение потоков
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const audioId = btn.dataset.audio;
            const audio = document.getElementById(audioId);
            const hasValidStream = audio.src && audio.src !== window.location.href + '#';

            if (btn.classList.contains('active')) {
                if (hasValidStream && !audio.paused) audio.pause();
                btn.classList.remove('active');
            } else {
                buttons.forEach(b => {
                    const otherAudio = document.getElementById(b.dataset.audio);
                    b.classList.remove('active');
                    if (otherAudio && !otherAudio.paused) {
                        otherAudio.pause();
                    }
                });

                btn.classList.add('active');
                if (hasValidStream) audio.play();
            }
        });
    });


      //-----------------------------------------------------\\
     // ================= Регулятор громкости =============== \\
    //---------------------------------------------------------\\


    const volumeControl = document.getElementById('volume');

    function initVolumeControl() {
        if (window.innerWidth > 768 && volumeControl) {
            volumeControl.style.display = 'block';
            audios.forEach(audio => audio.volume = volumeControl.value);

            volumeControl.addEventListener('input', () => {
                const volume = volumeControl.value;
                audios.forEach(audio => audio.volume = volume);
            });

        } else if (volumeControl) {
            volumeControl.style.display = 'none';
        }
    }

    window.addEventListener('DOMContentLoaded', initVolumeControl);
    window.addEventListener('resize', initVolumeControl);


      //-----------------------------------------------------\\
     // ================= Модальное окно ==================== \\
    //---------------------------------------------------------\\


    (function(){
        const modalEl = document.getElementById("modal");
        const hamburgerEl = document.getElementById("hamburger");
        const closeBtnEl = document.getElementById("closeModal"); // может быть null

        // Если нет обязательных элементов — выходим
        if (!modalEl || !hamburgerEl) return;

        function openMenu() {
            hamburgerEl.classList.add("active");
            modalEl.classList.add("active");
            document.body.classList.add("modal-open");
        }

        function closeMenu() {
            hamburgerEl.classList.remove("active");
            modalEl.classList.remove("active");
            document.body.classList.remove("modal-open");
        }

        // Toggle hamburger
        hamburgerEl.addEventListener("click", (e) => {
            // предотвращаем двойные клики/бублирование
            e.stopPropagation();
            if (hamburgerEl.classList.contains("active")) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        // Если существует кнопка внутри модалки — повесим на неё обработчик
        if (closeBtnEl) {
            closeBtnEl.addEventListener("click", (e) => {
                e.stopPropagation();
                closeMenu();
            });
        }

        // ESC закрывает
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modalEl.classList.contains("active")) {
                closeMenu();
            }
        });

        // Клик по фону модалки закрывает
        modalEl.addEventListener("click", (e) => {
            if (e.target === modalEl) closeMenu();
        });

        // Не даём кликам внутри контента всплыть на фон
        const modalContent = modalEl.querySelector(".modal-content");
        if (modalContent) {
            modalContent.addEventListener("click", (e) => e.stopPropagation());
        }
    })();

      //-----------------------------------------------------\\
     // ==================== Эквалайзер ===================== \\
    //---------------------------------------------------------\\


    const eqBands = document.querySelectorAll(".band input[type='range']");
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const frequencies = [
        32, 64, 125, 250, 500, 630, 800, 1000, 1250,
        1600, 2000, 2500, 3150, 4000, 5000, 6300,
        8000, 16000
    ];

    const filters = frequencies.map(freq => {
        const f = audioContext.createBiquadFilter();
        f.type = "peaking";
        f.frequency.value = freq;
        f.Q.value = 1;
        f.gain.value = 0;
        return f;
    });

    // цепочка фильтров
    filters.reduce((p, c) => { p.connect(c); return c; });
    const finalFilterNode = filters[filters.length - 1];

    // подключение аудио к фильтрам
    audios.forEach(audio => {
        const src = audioContext.createMediaElementSource(audio);
        src.connect(filters[0]);
    });

    finalFilterNode.connect(audioContext.destination);

    // изменение полос
    eqBands.forEach((slider, i) => {
        slider.addEventListener("input", () => {
            filters[i].gain.value = parseFloat(slider.value);
        });
    });

    // Save / Reset
    const saveBtn = document.getElementById("save-eq-settings");
    const resetBtn = document.getElementById("reset-eq-settings");
    const eqMessage = document.getElementById("eq-message");

    function showEqMessage(txt) {
        eqMessage.textContent = txt;
        eqMessage.style.opacity = 1;
        setTimeout(() => eqMessage.style.opacity = 0, 2000);
    }

    saveBtn.addEventListener("click", () => {
        const data = Array.from(eqBands).map(s => s.value);
        localStorage.setItem("eqSettings", JSON.stringify(data));
        showEqMessage("Settings saved");
    });

    resetBtn.addEventListener("click", () => {
        eqBands.forEach((s, i) => {
            s.value = 0;
            filters[i].gain.value = 0;
        });
        localStorage.removeItem("eqSettings");
        showEqMessage("Settings deleted");
    });

    window.addEventListener("DOMContentLoaded", () => {
        const saved = localStorage.getItem("eqSettings");
        if (saved) {
            JSON.parse(saved).forEach((val, i) => {
                eqBands[i].value = val;
                filters[i].gain.value = parseFloat(val);
            });
        }
    });

    // разрешение AudioContext
    window.addEventListener("click", () => {
        if (audioContext.state === "suspended") audioContext.resume();
    }, { once: true });


      //-----------------------------------------------------\\
     // ===== Анимация для активной кнопки по частотам ====== \\
    //---------------------------------------------------------\\


    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 128;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    finalFilterNode.connect(analyser);

    function animateButtons() {
        requestAnimationFrame(animateButtons);
        analyser.getByteFrequencyData(dataArray);

        const avg = dataArray.reduce((a, b) => a + b) / dataArray.length;
        const level = Math.min(100, (avg / 255) * 100);

        buttons.forEach(btn => {
            btn.style.setProperty("--eqHeight",
                btn.classList.contains("active") ? `${level}%` : "0%"
            );
        });
    }
    animateButtons();


      //-----------------------------------------------------\\
     // ============== Сохранение громкости ================= \\
    //---------------------------------------------------------\\

    const volumeSlider = document.getElementById("volume");

    // Загружаем громкость при старте
    const savedVol = localStorage.getItem("saved_volume");
    if (savedVol !== null) {
        volumeSlider.value = savedVol;
        audios.forEach(a => a.volume = savedVol);
    }

    // Сохраняем громкость при каждом изменении
    volumeSlider.addEventListener("input", () => {
        localStorage.setItem("saved_volume", volumeSlider.value);
    });


       //--------------------------------------------------------\\
      // ====== Перезагрузка страницы при обрыве потока ========= \\
     // === Работает даже при заблокированном экране телефона ==== \\
    //--------------------------------------------------------------\\

    function watchStream() {
        setInterval(() => {
            const activeBtn = document.querySelector(".btn.active");
            if (!activeBtn) return;

            const audio = document.getElementById(activeBtn.dataset.audio);
            if (!audio) return;

            // Если поток упал — перезагрузка страницы
            if (audio.error ||
                audio.networkState === HTMLMediaElement.NETWORK_NO_SOURCE ||
                audio.networkState === HTMLMediaElement.NETWORK_EMPTY ||
                (audio.paused && audio.src)
            ) {
                location.reload();
            }

        }, 3000); // каждые 3 секунды
    }

    watchStream();


      //-----------------------------------------------------\\
     // ================ Страница пароля ==================== \\
    //---------------------------------------------------------\\


    const REAL_PASSWORD = "F3$t_Y[L.7]"; // ← УСТАНОВИ СВОЙ ПАРОЛЬ
    const PROTECT_DIV = document.getElementById("password-protect");
    const MAX_ATTEMPTS = 5;

    // Загружаем количество попыток
    let attempts = Number(localStorage.getItem("password_attempts")) || 0;

    // Если пароль уже вводили — открываем сайт
    if (localStorage.getItem("access_granted") === "yes") {
        PROTECT_DIV.classList.add("hidden");
    }

    // Если попытки закончились
    if (attempts >= MAX_ATTEMPTS) lockSystem();

    // === Прячем placeholder при клике и возвращаем при выходе ===
    const passInput = document.getElementById("pass-input");

    passInput.addEventListener("focus", () => {
        passInput.setAttribute("data-placeholder", passInput.placeholder);
        passInput.placeholder = "";
    });

    passInput.addEventListener("blur", () => {
        if (passInput.value === "") {
            passInput.placeholder = passInput.getAttribute("data-placeholder");
        }
    });

    document.getElementById("pass-btn").addEventListener("click", checkPass);
    document.getElementById("pass-input").addEventListener("keypress", (e) => {
        if (e.key === "Enter") checkPass();
    });

    function checkPass() {
        const input = document.getElementById("pass-input").value;

        // Если попыток больше нет
        if (attempts >= MAX_ATTEMPTS) {
            lockSystem();
            return;
        }

        if (input === REAL_PASSWORD) {
            localStorage.setItem("access_granted", "yes");
            PROTECT_DIV.classList.add("hidden");

            setTimeout(() => {
                PROTECT_DIV.style.display = "none";
            }, 600);

        } else {
            attempts++;
            localStorage.setItem("password_attempts", attempts);

            document.getElementById("wrong-pass").style.display = "block";

            // Показываем сколько осталось попыток
            const left = MAX_ATTEMPTS - attempts;
            const attemptsDiv = document.getElementById("attempts-left");
            attemptsDiv.style.display = "block";
            attemptsDiv.textContent = `Attempts left: ${left}`;

            if (attempts >= MAX_ATTEMPTS) {
                lockSystem();
            }

            setTimeout(() => {
                document.getElementById("wrong-pass").style.display = "none";
            }, 2000);
        }
    }

    function lockSystem() {
        document.getElementById("locked").style.display = "block";
        document.getElementById("attempts-left").style.display = "none";
        document.getElementById("pass-btn").disabled = true;
        document.getElementById("pass-input").disabled = true;
    }


      //-----------------------------------------------------\\
     // ========== Выпадающий список для донатов ============ \\
    //---------------------------------------------------------\\


    const donateBtn = document.getElementById("donateBtn");
    const dropdown = document.getElementById("donateDropdown");

    let open = false;

    donateBtn.addEventListener("click", () => {
        open = !open;

        if (open) {
            dropdown.classList.add("active");
            donateBtn.textContent = "CLOSE";
        } else {
            dropdown.classList.remove("active");
            donateBtn.textContent = "DONATE";
        }
    });


    </script>
    <script src="js/gsap.min.js"></script>


</body>
</html>